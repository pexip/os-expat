From: Sebastian Pipping <sebastian@pipping.org>
Date: Sat, 12 Feb 2022 00:51:43 +0100
Subject: tests: Cover CVE-2022-25236
Origin: https://github.com/libexpat/libexpat/commit/2de077423fb22750ebea599677d523b53cb93b1d
Bug: https://github.com/libexpat/libexpat/pull/561

[Salvatore Bonaccorso: Backport to 2.2.6 for context changes]
---
 expat/tests/runtests.c | 30 ++++++++++++++++++++++++++++++
 1 file changed, 30 insertions(+)

--- a/expat/tests/runtests.c
+++ b/expat/tests/runtests.c
@@ -7902,6 +7902,35 @@ START_TEST(test_ns_double_colon_doctype)
 }
 END_TEST
 
+START_TEST(test_ns_separator_in_uri) {
+  struct test_case {
+    enum XML_Status expectedStatus;
+    const char *doc;
+  };
+  struct test_case cases[] = {
+      {XML_STATUS_OK, "<doc xmlns='one_two' />"},
+      {XML_STATUS_ERROR, "<doc xmlns='one&#x0A;two' />"},
+  };
+
+  size_t i = 0;
+  size_t failCount = 0;
+  for (; i < sizeof(cases) / sizeof(cases[0]); i++) {
+    XML_Parser parser = XML_ParserCreateNS(NULL, '\n');
+    XML_SetElementHandler(parser, dummy_start_element, dummy_end_element);
+    if (XML_Parse(parser, cases[i].doc, (int)strlen(cases[i].doc),
+                  /*isFinal*/ XML_TRUE)
+        != cases[i].expectedStatus) {
+      failCount++;
+    }
+    XML_ParserFree(parser);
+  }
+
+  if (failCount) {
+    fail("Namespace separator handling is broken");
+  }
+}
+END_TEST
+
 /* Control variable; the number of times duff_allocator() will successfully allocate */
 #define ALLOC_ALWAYS_SUCCEED (-1)
 #define REALLOC_ALWAYS_SUCCEED (-1)
@@ -12240,6 +12269,7 @@ make_suite(void)
     tcase_add_test(tc_namespace, test_ns_utf16_doctype);
     tcase_add_test(tc_namespace, test_ns_invalid_doctype);
     tcase_add_test(tc_namespace, test_ns_double_colon_doctype);
+    tcase_add_test(tc_namespace, test_ns_separator_in_uri);
 
     suite_add_tcase(s, tc_misc);
     tcase_add_checked_fixture(tc_misc, NULL, basic_teardown);
